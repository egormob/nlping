# Журнал лимитов diff

| Дата/шаг | Тип задачи | Файлы/директории | `git diff --stat` | Статус | Комментарии |
| --- | --- | --- | --- | --- | --- |
| 2025-10-05T00:00Z / Протокол DOC-ADAPT | Документация | `memory-bank/MB-02_RABOCHIE_PRINCIPY.md`, `DOROZHNAYA_KARTA.md`, `memory-bank/diff-limit-plan.md` | 3 files, 25 insertions (+) | ✅ | Добавлено правило адаптивного прощупывания лимита diff и создан журнал. |
| 2025-10-05T10:40Z / Подготовка D2 GUID F* | Перекодировка HTML | `F47*.html` (первая подсерия) | 12 files, 1210 insertions(+), 1186 deletions(-) | ✅ | Стартовый блок на 12 файлов прошёл, стратегия «обстукивания туннеля» подтверждена; обновили `safe_bound_html_guid` и зафиксировали логи `logs/reencode-20251003T095151Z.json`, `logs/check_utf8-20251003T095227Z.json`. |
| 2025-10-03T10:02Z / Этап D2 GUID F47x | Перекодировка HTML | `F4792.html`…`F47BA.html`, `DOROZHNAYA_KARTA.md` | 13 files, 1547 insertions(+), 1545 deletions(-) | ✅ | Подсерия `F47x` закрыта: подтвердили безопасный объём (12 файлов), логи `logs/reencode-20251003T100140Z.json`, `logs/check_utf8-20251003T100152Z.json`, план обновлён. |
| 2025-10-03T12:29Z / Этап D2 GUID F48x (партия 1) | Перекодировка HTML | `F4833.html`…`F486E.html`, `DOROZHNAYA_KARTA.md` | 13 files, 984 insertions(+), 982 deletions(-) | ✅ | Партия на 12 файлов уложилась в лимит; charset обновлён, логи `logs/reencode-20251003T122902Z.json`, `logs/check_utf8-20251003T122949Z.json`. |
| 2025-10-03T13:31Z / Этап D2 GUID F48x (партия 2) | Перекодировка HTML | `F4876.html`…`F48A9.html`, `DOROZHNAYA_KARTA.md` | 14 files, 1264 insertions(+), 1262 deletions(-) | ✅ | Партия `F4876`…`F48A9` прошла без превышения лимита; зафиксированы `logs/reencode-20251003T133116Z.json`, `logs/check_utf8-20251003T133135Z.json`, впереди завершающие `F48AB.html`…`F48ED.html`. |
| 2025-10-02T15:58Z / Этап D2 GUID D–E | Перекодировка HTML | `D02DBF37-F46B9-834FCE15.html`…`EF55077A-F45BC-9F9EDC1A.html` | 15 files, 1475 insertions(+), 1475 deletions(-) | ✅ | Партия `[DE]*.html`, дифф симметричный, укладывается в лимит. Следующая калибровка — для `F*`. |
| 2025-10-03T19:52Z / Этап D2 GUID F49x | Перекодировка HTML | `F4902.html`, `F49ED.html`, `DOROZHNAYA_KARTA.md`, `memory-bank/diff-limit-plan.md` | 4 files, 370 insertions(+), 366 deletions(-) | ✅ | Мини-партия на 2 файла подтверждает запас по лимиту; журнал и дорожная карта обновлены, далее планируем `F4Ax`. |
| 2025-10-03T20:04Z / Этап D2 GUID F4Ax (партия 1) | Перекодировка HTML | `F4A11.html`…`F4A46.html`, `DOROZHNAYA_KARTA.md` | 13 files, 1259 insertions(+), 1256 deletions(-) | ✅ | Партия из 12 GUID-файлов прошла в пределах лимита; зафиксированы `logs/reencode-20251003T200347Z.json`, `logs/check_utf8-20251003T200422Z.json`, следующий блок `F4A47.html`…`F4A99.html`. |
| 2025-10-03T20:21Z / Этап D2 GUID F4Ax (партия 2) | Перекодировка HTML | `F4AA1.html`…`F4ACB.html`, `DOROZHNAYA_KARTA.md` | 12 files, 612 insertions(+), 612 deletions(-) | ✅ | Подтвердили партию `F4AA1`…`F4ACB`: обновлены charset и логи `logs/reencode-20251003T202056Z.json`, `logs/check_utf8-20251003T202127Z.json`; следующий блок `F4AD6.html`…`F4AFD`. |

## Текущие ориентиры

- `safe_bound_html_guid`: 12 файлов (блок `F471B.html`…`F478D.html`, 2025-10-03); ранее подтверждён максимум 15 файлов на партии `[DE]*.html` (2025-10-02).
- `fail_bound_html_guid`: TBD — добавим после первой неудачи.

### Анализ прошлой стратегии

- Последние неудачные прогоны пытались «приглушить» лимит, постепенно снижая верхнюю границу. Такой подход приводит к серии провалов, потому что мы не фиксируем опорный нижний уровень и не возвращаемся к нему сразу после удачной итерации.
- Для серий `F*` объём выше 150 файлов провоцирует лимит диффа и тяжёлые проверки. Чтобы держать темп, нужна адаптация с чётким чередованием успешных и тестовых попыток.

### Новый протокол «обстукивание туннеля»

1. **Старт от верняка.** Берём размер, который уже подтвердился (`safe_bound_html_guid` = 15 файлов) и формируем первую подсерии на 10–12 файлов, чтобы гарантированно получить «зелёный» проход.
2. **Фиксация границ.** После каждой попытки обновляем журнал: если партия прошла — расширяем `safe_bound_html_guid`, если упёрлись в лимит — записываем `fail_bound_html_guid` и снижаем объём следующей партии до середины между границами.
3. **Чередование попыток.** После неудачной попытки обязательно возвращаемся к последнему успешному размеру, чтобы не было двух «красных» подряд. Затем двигаем границу, приближаясь к `fail_bound_html_guid` маленькими шагами (±2 файла).
4. **Группировка по кластерам.** Для `F*` планируем партии по подсериям (`F47x`, `F48x`, `F4Ax`, …), внутри кластера сортируем по алфавиту и дробим на блоки не более 15 файлов.
5. **Документирование.** Перед каждой новой партией фиксируем план и ожидаемый объём (как строкой в таблице выше), после завершения обновляем статус и фактический `git diff --stat`.

## История изменений документа

- 2025-10-05 — создан журнал и добавлено правило «Адаптивное прощупывание лимита diff» в `MB-02_RABOCHIE_PRINCIPY.md`.
- 2025-10-05 — уточнена стратегия регулировки лимита («обстукивание туннеля») и заведены отдельные границы для GUID-файлов.
