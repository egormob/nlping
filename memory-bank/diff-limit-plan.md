# Журнал лимитов diff

| Дата/шаг | Тип задачи | Файлы/директории | `git diff --stat` | Статус | Комментарии |
| --- | --- | --- | --- | --- | --- |
| 2025-10-05T00:00Z / Протокол DOC-ADAPT | Документация | `memory-bank/MB-02_RABOCHIE_PRINCIPY.md`, `DOROZHNAYA_KARTA.md`, `memory-bank/diff-limit-plan.md` | 3 files, 25 insertions (+) | ✅ | Добавлено правило адаптивного прощупывания лимита diff и создан журнал. |
| 2025-10-05T10:40Z / Подготовка D2 GUID F* | Перекодировка HTML | `F47*.html` (первая подсерия) | 12 files, 1210 insertions(+), 1186 deletions(-) | ✅ | Стартовый блок на 12 файлов прошёл, стратегия «обстукивания туннеля» подтверждена; обновили `safe_bound_html_guid` и зафиксировали логи `logs/reencode-20251003T095151Z.json`, `logs/check_utf8-20251003T095227Z.json`. |
| 2025-10-02T15:58Z / Этап D2 GUID D–E | Перекодировка HTML | `D02DBF37-F46B9-834FCE15.html`…`EF55077A-F45BC-9F9EDC1A.html` | 15 files, 1475 insertions(+), 1475 deletions(-) | ✅ | Партия `[DE]*.html`, дифф симметричный, укладывается в лимит. Следующая калибровка — для `F*`. |

## Текущие ориентиры

- `safe_bound_html_guid`: 12 файлов (блок `F471B.html`…`F478D.html`, 2025-10-03); ранее подтверждён максимум 15 файлов на партии `[DE]*.html` (2025-10-02).
- `fail_bound_html_guid`: TBD — добавим после первой неудачи.

### Анализ прошлой стратегии

- Последние неудачные прогоны пытались «приглушить» лимит, постепенно снижая верхнюю границу. Такой подход приводит к серии провалов, потому что мы не фиксируем опорный нижний уровень и не возвращаемся к нему сразу после удачной итерации.
- Для серий `F*` объём выше 150 файлов провоцирует лимит диффа и тяжёлые проверки. Чтобы держать темп, нужна адаптация с чётким чередованием успешных и тестовых попыток.

### Новый протокол «обстукивание туннеля»

1. **Старт от верняка.** Берём размер, который уже подтвердился (`safe_bound_html_guid` = 15 файлов) и формируем первую подсерии на 10–12 файлов, чтобы гарантированно получить «зелёный» проход.
2. **Фиксация границ.** После каждой попытки обновляем журнал: если партия прошла — расширяем `safe_bound_html_guid`, если упёрлись в лимит — записываем `fail_bound_html_guid` и снижаем объём следующей партии до середины между границами.
3. **Чередование попыток.** После неудачной попытки обязательно возвращаемся к последнему успешному размеру, чтобы не было двух «красных» подряд. Затем двигаем границу, приближаясь к `fail_bound_html_guid` маленькими шагами (±2 файла).
4. **Группировка по кластерам.** Для `F*` планируем партии по подсериям (`F47x`, `F48x`, `F4Ax`, …), внутри кластера сортируем по алфавиту и дробим на блоки не более 15 файлов.
5. **Документирование.** Перед каждой новой партией фиксируем план и ожидаемый объём (как строкой в таблице выше), после завершения обновляем статус и фактический `git diff --stat`.

## История изменений документа

- 2025-10-05 — создан журнал и добавлено правило «Адаптивное прощупывание лимита diff» в `MB-02_RABOCHIE_PRINCIPY.md`.
- 2025-10-05 — уточнена стратегия регулировки лимита («обстукивание туннеля») и заведены отдельные границы для GUID-файлов.
