# MB-02 — Рабочие принципы

- **Минимальные партии.** Одно логическое действие → один коммит, не более ~150 файлов. При перекодировке — одна поддиректория за итерацию.
- **Двойная проверка.** Каждый шаг подтверждаю автоматическим скриптом + выборочной ручной проверкой (минимум 3 страницы).
- **Всегда готов к откату.** После завершения подпункта проверяю `git status`, коммит, обновляю журнал в `DOROZHNAYA_KARTA.md`.
- **Дифф под контролем.** Перед коммитом смотрю `git diff --stat` и объём (если >1.5 МБ — делю партию).
  - **Адаптивное прощупывание лимита diff.**
    1. **Фиксируем опорные значения.** После каждого шага заношу в `memory-bank/diff-limit-plan.md` тип задачи, задействованные зоны, итог `git diff --stat`, статус «проходит/не проходит» и наблюдения.
    2. **Стартовая калибровка.** При отсутствии безопасного порога беру умеренную партию (~150–200 строк или 3–4 файла), проверяю `git diff --stat` и записываю результат как `safe_bound`.
    3. **Подбор целевого размера.** Если есть и `safe_bound`, и ближайший `fail_bound`, ориентируюсь на среднее значение (или 80 % `fail_bound`). Если есть только `safe_bound` — увеличиваю объём на 10–20 % и перепроверяю; если только `fail_bound` — делю текущий набор и тестирую меньшую часть.
    4. **Проверка перед коммитом.** Сравниваю текущий `git diff --stat` с целевым размером. При превышении дроблю изменения (`git add -p`, отдельные коммиты) и фиксирую, что именно отправлено.
    5. **Реакция на неудачу.** При упоре в лимит немедленно записываю фактический `fail_bound`, делю набор файлов пополам и продолжаю в формате бинарного поиска между `safe_bound` и `fail_bound`.
    6. **Категоризация задач.** Для разных типов работ (HTML, документация, бинарные артефакты) веду отдельные `safe_bound`/`fail_bound`. При смешанных партиях беру минимальный безопасный предел.
    7. **Непрерывное уточнение.** После каждого коммита обновляю `safe_bound` на максимум успешных значений и, при появлении новых типов задач, повторяю калибровку.
    8. **Привязка к Протоколу.** В шагах Протокола обязательно обращаюсь к журналу `memory-bank/diff-limit-plan.md` и следую этой процедуре, чтобы избегать перегрузки diff и сохранять высокую скорость.
- **Документация.** Любые уточнения записываю в дорожной карте и здесь, чтобы после обрыва контекста легко восстановиться.
- **Протокол.** Всегда начинаю с команды «Протокол, шаг <код этапа>», чтобы последовательно пройти Memory → Roadmap → Instruction и не забыть ни один документ.
- **Артефакты вне git.** Baseline, логи и слепки складываем в `snapshot/` и `logs/` (эти каталоги в `.gitignore`), чтобы не появлялись тяжёлые диффы.
- **Каждая сессия начинается с Протокола.** Перед работой даю команду «Протокол, шаг <код этапа>», чтобы заново открыть дорожную карту, инструкцию и нужные памятки — этого достаточно даже после зависания браузера.

### Ветка и PR
- Рабочая ветка всегда `work`.
- Перед началом: `git fetch origin && (git checkout work || git checkout -B work origin/main) && git pull --ff-only`.
- После шага: PR `work → main` → Squash and merge → авто-удаление ветки.
- В конфликтах по DOROZHNAYA_KARTA.md, INSTRUKTSIYA_VYPOLNENIYA.md, MB-06, tools/check_utf8.py — берём версию из `work`.
